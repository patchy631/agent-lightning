
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/agent-lightning/latest/reference/trainer/">
      
      
        <link rel="prev" href="../store/">
      
      
        <link rel="next" href="../types/">
      
      
      <link rel="icon" href="../../assets/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Trainer - Agent Lightning</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="agl" data-md-color-accent="agl">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agent-lightning-trainer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Agent Lightning" class="md-header__button md-logo" aria-label="Agent Lightning" data-md-component="logo">
      
  <img src="../../assets/favicon-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Agent Lightning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Trainer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="agl" data-md-color-accent="agl"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="agl" data-md-color-accent="agl"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/agent-lightning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agent-lightning
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Agent Lightning" class="md-nav__button md-logo" aria-label="Agent Lightning" data-md-component="logo">
      
  <img src="../../assets/favicon-white.svg" alt="logo">

    </a>
    Agent Lightning
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/agent-lightning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    agent-lightning
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Quickstart
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/train-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Train the First Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/write-first-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write the First Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    How-To Recipes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/unsloth-sft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SFT with Unsloth
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/train-sql-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Train SQL Agent with RL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Learning More
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Learning More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/write-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/parallelize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parallelize
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Algorithm Zoo
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Algorithm Zoo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithm-zoo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithm-zoo/apo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    APO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithm-zoo/verl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VERL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Deep Dive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Deep Dive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dive/birds-eye-view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bird's Eye View
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dive/store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dive/tracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding Tracing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command Line
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../instrumentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Instrumentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Trainer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Trainer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agentlightning.Trainer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Trainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agentlightning.Trainer.dev" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;dev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agentlightning.Trainer.fit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.build_component" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExecutionStrategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ClientServerExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ClientServerExecutionStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ClientServerExecutionStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agentlightning.ClientServerExecutionStrategy.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.SharedMemoryExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SharedMemoryExecutionStrategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ExecutionEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExecutionEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ThreadingEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ThreadingEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.MultiprocessingEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultiprocessingEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-builder" class="md-nav__link">
    <span class="md-ellipsis">
      CLI Builder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.lightning_cli" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;lightning_cli
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agentlightning.Trainer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Trainer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agentlightning.Trainer.dev" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;dev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agentlightning.Trainer.fit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.build_component" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExecutionStrategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ClientServerExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ClientServerExecutionStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ClientServerExecutionStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agentlightning.ClientServerExecutionStrategy.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.SharedMemoryExecutionStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SharedMemoryExecutionStrategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ExecutionEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExecutionEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.ThreadingEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ThreadingEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.MultiprocessingEvent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultiprocessingEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-builder" class="md-nav__link">
    <span class="md-ellipsis">
      CLI Builder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agentlightning.lightning_cli" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;lightning_cli
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  <div id="version-warning" class="version-warning" style="display: none;">
    ⚠️ You are viewing development documentation. For stable documentation, please visit
    <a href="https://microsoft.github.io/agent-lightning/stable/">https://microsoft.github.io/agent-lightning/stable/</a>
  </div>
  
                  


  
  


<h1 id="agent-lightning-trainer">Agent-lightning Trainer<a class="headerlink" href="#agent-lightning-trainer" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<h2 id="agentlightning.Trainer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.Trainer</code>


<a href="#agentlightning.Trainer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agentlightning.trainer.legacy.TrainerLegacy">TrainerLegacy</span></code></p>


        <p>Orchestrates the distributed execution of agent rollouts.</p>
<p>The Trainer is responsible for launching one or more worker processes
that run the agent's execution loop. It manages multiprocessing,
handles graceful shutdown, and serves as the main entry point for
running a client-side agent fleet.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.algorithm">algorithm</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>BaseAlgorithm</code> to use for training.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.store">store</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>LightningStore</code> to use for storing tasks and traces.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.runner">runner</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>BaseRunner</code> to use for running the agent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.initial_resources">initial_resources</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>Resources</code> to use for bootstrapping the fit/dev process.
The resources will be handed over to the algorithm.
Note that not all algorithms support seeding resources.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.n_runners">n_runners</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of agent runners to run in parallel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.max_rollouts">max_rollouts</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of rollouts to process per runner. If None,
          workers run until no more rollouts are available.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.strategy">strategy</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>ExecutionStrategy</code> to use for spawning the algorithm and runners.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.tracer">tracer</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tracer instance, or a string pointing to the class full name or a dictionary with a 'type' key
    that specifies the class full name and other initialization parameters.
    If None, a default <code>AgentOpsTracer</code> will be created with the current settings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.hooks">hooks</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sequence of <code>Hook</code> instances to be called at various lifecycle stages (e.g., on_trace_start,
   on_trace_end, on_rollout_start, on_rollout_end).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.adapter">adapter</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>TracerTraceToTriplet</code> to export data consumble by algorithms from traces.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.llm_proxy">llm_proxy</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>LLMProxy</code> to use for intercepting the LLM calls.
       If not provided, algorithm will create one on its own.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.n_workers">n_workers</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of agent workers to run in parallel. Deprecated in favor of <code>n_runners</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.max_tasks">max_tasks</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of tasks to process per runner. Deprecated in favor of <code>max_rollouts</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.daemon">daemon</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether worker processes should be daemons. Daemon processes
    are terminated automatically when the main process exits. Deprecated.
    Only have effect with <code>fit_v0</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agentlightning.Trainer.triplet_exporter">triplet_exporter</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of <code>TracerTraceToTriplet</code> to export triplets from traces,
              or a dictionary with the initialization parameters for the exporter.
              Deprecated. Use <code>adapter</code> instead.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            dev(agent, train_dataset=None, *, val_dataset=None) (agentlightning.Trainer.dev)" href="#agentlightning.Trainer.dev">dev</a></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, rollouts are run against the dev endpoint provided in <code>fit</code>.
 Deprecated in favor of <code>dev()</code> method.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>agentlightning/trainer/trainer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">class</span><span class="w"> </span><span class="nc">Trainer</span><span class="p">(</span><span class="n">TrainerLegacy</span><span class="p">):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrates the distributed execution of agent rollouts.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    The Trainer is responsible for launching one or more worker processes</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    that run the agent&#39;s execution loop. It manages multiprocessing,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    handles graceful shutdown, and serves as the main entry point for</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    running a client-side agent fleet.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        algorithm: An instance of `BaseAlgorithm` to use for training.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        store: An instance of `LightningStore` to use for storing tasks and traces.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        runner: An instance of `BaseRunner` to use for running the agent.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        initial_resources: An instance of `Resources` to use for bootstrapping the fit/dev process.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            The resources will be handed over to the algorithm.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            Note that not all algorithms support seeding resources.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        n_runners: Number of agent runners to run in parallel.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        max_rollouts: Maximum number of rollouts to process per runner. If None,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                      workers run until no more rollouts are available.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        strategy: An instance of `ExecutionStrategy` to use for spawning the algorithm and runners.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        tracer: A tracer instance, or a string pointing to the class full name or a dictionary with a &#39;type&#39; key</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">                that specifies the class full name and other initialization parameters.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                If None, a default `AgentOpsTracer` will be created with the current settings.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        hooks: A sequence of `Hook` instances to be called at various lifecycle stages (e.g., on_trace_start,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">               on_trace_end, on_rollout_start, on_rollout_end).</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        adapter: An instance of `TracerTraceToTriplet` to export data consumble by algorithms from traces.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        llm_proxy: An instance of `LLMProxy` to use for intercepting the LLM calls.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                   If not provided, algorithm will create one on its own.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        n_workers: Number of agent workers to run in parallel. Deprecated in favor of `n_runners`.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        max_tasks: Maximum number of tasks to process per runner. Deprecated in favor of `max_rollouts`.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        daemon: Whether worker processes should be daemons. Daemon processes</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                are terminated automatically when the main process exits. Deprecated.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                Only have effect with `fit_v0`.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        triplet_exporter: An instance of `TracerTraceToTriplet` to export triplets from traces,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">                          or a dictionary with the initialization parameters for the exporter.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                          Deprecated. Use `adapter` instead.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        dev: If True, rollouts are run against the dev endpoint provided in `fit`.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">             Deprecated in favor of `dev()` method.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">dev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">n_runners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">max_rollouts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">initial_resources</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NamedResources</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">tracer</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseTracer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">adapter</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">TraceAdapter</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">LightningStore</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">runner</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseRunner</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">ExecutionStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseAlgorithm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">llm_proxy</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">LLMProxy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">n_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">max_tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">daemon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">triplet_exporter</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">TracerTraceToTriplet</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Hook</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hook</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="c1"># Do not call super().__init__() here.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># super().__init__() will call TrainerLegacy&#39;s initialization, which is not intended.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dev</span> <span class="o">=</span> <span class="n">dev</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="n">daemon</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">:</span> <span class="n">AgentLightningClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be initialized in fit or fit_v0</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="s2">&quot;`n_workers` is deprecated. Please use `n_runners`.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="n">n_runners</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">n_runners</span> <span class="o">=</span> <span class="n">n_workers</span> <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_workers</span> <span class="o">!=</span> <span class="n">n_runners</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                    <span class="s2">&quot;`n_workers` is ignored when `n_runners` is provided.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">=</span> <span class="n">n_runners</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_workers</span> <span class="o">=</span> <span class="n">n_runners</span>  <span class="c1"># Backwards compatibility for fit_v0</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">if</span> <span class="n">max_tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="s2">&quot;`max_tasks` is deprecated. Please use `max_rollouts`.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">if</span> <span class="n">max_rollouts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">max_rollouts</span> <span class="o">=</span> <span class="n">max_tasks</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">elif</span> <span class="n">max_tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_tasks</span> <span class="o">!=</span> <span class="n">max_rollouts</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="s2">&quot;`max_tasks` is ignored when `max_rollouts` is provided.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_rollouts</span> <span class="o">=</span> <span class="n">max_rollouts</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_tasks</span> <span class="o">=</span> <span class="n">max_tasks</span> <span class="k">if</span> <span class="n">max_tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_rollouts</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_tracer</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">if</span> <span class="n">adapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">triplet_exporter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="s2">&quot;`triplet_exporter` is deprecated and ignored because `adapter` is provided.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">adapter_spec</span> <span class="o">=</span> <span class="n">adapter</span> <span class="k">if</span> <span class="n">adapter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">triplet_exporter</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_adapter</span><span class="p">(</span><span class="n">adapter_spec</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">triplet_exporter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span>  <span class="c1"># Backwards compatibility</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># We might be able to support a list of resources in future.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_resources</span> <span class="o">=</span> <span class="n">initial_resources</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="c1"># The active store for the current execution context</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_runner</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">n_runners</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">,</span> <span class="s2">&quot;n_runners&quot;</span><span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">strategy_runners</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">,</span> <span class="s2">&quot;n_runners&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strategy_runners</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">strategy_runners</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">=</span> <span class="n">strategy_runners</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_workers</span> <span class="o">=</span> <span class="n">strategy_runners</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">llm_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_llm_proxy</span><span class="p">(</span><span class="n">llm_proxy</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_hooks</span><span class="p">(</span><span class="n">hooks</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">daemon</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="s2">&quot;daemon=False. Worker processes are non-daemonic. &quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="s2">&quot;The worker processes will NOT be terminated when the main process exits. &quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="s2">&quot;The cleanup must be handled manually.&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_tracer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracer</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseTracer</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BaseTracer</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a tracer instance based on the provided configuration.&quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">default_factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">AgentOpsTracer</span><span class="p">(</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">agentops_managed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">instrument_managed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">daemon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">daemon</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">tracer</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">BaseTracer</span><span class="p">,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">default_factory</span><span class="o">=</span><span class="n">default_factory</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">dict_requires_type</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid tracer type: </span><span class="si">{actual_type}</span><span class="s2">. Expected BaseTracer, str, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Tracer factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not a BaseTracer subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseAlgorithm</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseAlgorithm</span><span class="p">]:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an algorithm instance based on the provided configuration.&quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">BaseAlgorithm</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid algorithm type: </span><span class="si">{actual_type}</span><span class="s2">. Expected BaseAlgorithm, str, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Algorithm factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not a BaseAlgorithm subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_adapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adapter</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">TraceAdapter</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">TraceAdapter</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">adapter</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">TraceAdapter</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;adapter&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">default_factory</span><span class="o">=</span><span class="n">TracerTraceToTriplet</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">dict_requires_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">dict_default_cls</span><span class="o">=</span><span class="n">TracerTraceToTriplet</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid adapter type: </span><span class="si">{actual_type}</span><span class="s2">. Expected TraceAdapter, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Adapter factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not a TraceAdapter subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">LightningStore</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">LightningStore</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">store</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">default_factory</span><span class="o">=</span><span class="n">InMemoryLightningStore</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid store type: </span><span class="si">{actual_type}</span><span class="s2">. Expected LightningStore, str, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Store factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not a LightningStore subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_strategy</span><span class="p">(</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">ExecutionStrategy</span><span class="p">],</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">n_runners</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStrategy</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">ExecutionStrategy</span><span class="p">):</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">return</span> <span class="n">strategy</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n_runners&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">n_runners</span><span class="p">}</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">default_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ExecutionStrategy</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">return</span> <span class="n">ClientServerExecutionStrategy</span><span class="p">(</span><span class="n">n_runners</span><span class="o">=</span><span class="n">n_runners</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">strategy</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">ExecutionStrategy</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;strategy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">default_factory</span><span class="o">=</span><span class="n">default_factory</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid strategy type: </span><span class="si">{actual_type}</span><span class="s2">. Expected ExecutionStrategy, str, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Strategy factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not an ExecutionStrategy subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">registry</span><span class="o">=</span><span class="n">ExecutionStrategyRegistry</span><span class="p">,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_llm_proxy</span><span class="p">(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">llm_proxy</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">LLMProxy</span><span class="p">],</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LLMProxy</span><span class="p">]:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm_proxy</span><span class="p">,</span> <span class="n">LLMProxy</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="k">return</span> <span class="n">llm_proxy</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">store</span><span class="p">}</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm_proxy</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">llm_proxy</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">llm_proxy</span><span class="p">}</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">llm_proxy</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">llm_proxy</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">LLMProxy</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;llm_proxy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid llm_proxy type: </span><span class="si">{actual_type}</span><span class="s2">. Expected LLMProxy, dict, str, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;llm_proxy factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not an LLMProxy subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_runner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">ComponentSpec</span><span class="p">[</span><span class="n">BaseRunner</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">BaseRunner</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tracer&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracer</span><span class="p">}</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rollouts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">optional_defaults</span><span class="p">[</span><span class="s2">&quot;max_rollouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rollouts</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">default_runner_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">BaseRunner</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="k">return</span> <span class="n">instantiate_component</span><span class="p">(</span><span class="n">LitAgentRunner</span><span class="p">,</span> <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">return</span> <span class="n">build_component</span><span class="p">(</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">runner</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">expected_type</span><span class="o">=</span><span class="n">BaseRunner</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="s2">&quot;runner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">default_factory</span><span class="o">=</span><span class="n">default_runner_factory</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="s2">&quot;Invalid runner type: </span><span class="si">{actual_type}</span><span class="s2">. Expected BaseRunner, callable, str, dict, or None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">type_error_fmt</span><span class="o">=</span><span class="s2">&quot;Runner factory returned </span><span class="si">{type_name}</span><span class="s2">, which is not a BaseRunner subclass.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Hook</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hook</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hook</span><span class="p">]:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">if</span> <span class="n">hooks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="k">return</span> <span class="p">()</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hooks</span><span class="p">,</span> <span class="n">Hook</span><span class="p">):</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">hooks</span><span class="p">,)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">hooks</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">LitAgent</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the training loop using the configured strategy, store, and runner.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">            agent: The LitAgent instance to be trained on.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">            train_dataset: The dataset to train on.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">            val_dataset: The dataset to validate on.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">set_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">algorithm_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_bundle</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">runner_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_runner_bundle</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">algorithm_bundle</span><span class="p">,</span> <span class="n">runner_bundle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dev</span><span class="p">(</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">agent</span><span class="p">:</span> <span class="n">LitAgent</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dry run the training loop with a FastAlgorithm and the real runner.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            agent: The LitAgent instance to be trained on.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            train_dataset: The dataset to train on.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">            val_dataset: The dataset to validate on.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">            TypeError: If the configured algorithm is not a :class:`FastAlgorithm`.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">set_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="c1"># Sanity check</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">algorithm</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">()</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">FastAlgorithm</span><span class="p">):</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="s2">&quot;Trainer.dev() requires an algorithm that inherits from FastAlgorithm. &quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">algorithm_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_bundle</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">runner_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_runner_bundle</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">algorithm_bundle</span><span class="p">,</span> <span class="n">runner_bundle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_algorithm_bundle</span><span class="p">(</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="n">event</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]],</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]],</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseAlgorithm</span><span class="p">],</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">algorithm</span><span class="o">.</span><span class="n">set_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">algorithm</span><span class="o">.</span><span class="n">set_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">algorithm</span><span class="o">.</span><span class="n">set_adapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adapter</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_resources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="n">algorithm</span><span class="o">.</span><span class="n">set_initial_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_resources</span><span class="p">)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">llm_proxy</span><span class="o">.</span><span class="n">set_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">algorithm</span><span class="o">.</span><span class="n">set_llm_proxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_proxy</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="k">while</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="k">return</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">is_async</span><span class="p">():</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                <span class="k">await</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                    <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="c1"># This will block the event loop to maximize the debugging experience</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="c1"># It&#39;s the responsibility of the execution strategy to enable async execution</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="n">algorithm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                    <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle encountered an error.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="k">raise</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_runner_bundle</span><span class="p">(</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">LitAgent</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">runner_instance</span><span class="p">:</span> <span class="n">BaseRunner</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">runner_initialized</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">worker_initialized</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="c1"># If not using shm execution strategy, we are already in the forked process</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="n">runner_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">runner_instance</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span> <span class="n">hooks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="n">runner_initialized</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="n">runner_instance</span><span class="o">.</span><span class="n">init_worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="n">worker_initialized</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>            <span class="k">await</span> <span class="n">runner_instance</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Runner bundle encountered an error (worker_id=</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">raise</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="k">if</span> <span class="n">runner_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="k">if</span> <span class="n">worker_initialized</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                        <span class="n">runner_instance</span><span class="o">.</span><span class="n">teardown_worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during runner worker teardown (worker_id=</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="k">if</span> <span class="n">runner_initialized</span><span class="p">:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                        <span class="n">runner_instance</span><span class="o">.</span><span class="n">teardown</span><span class="p">()</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during runner teardown (worker_id=</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="agentlightning.Trainer.dev" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">dev</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">train_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">val_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#agentlightning.Trainer.dev" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Dry run the training loop with a FastAlgorithm and the real runner.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            agentlightning.LitAgent (agentlightning.litagent.LitAgent)" href="../agent/#agentlightning.LitAgent">LitAgent</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LitAgent instance to be trained on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_dataset</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            agentlightning.Dataset (agentlightning.types.Dataset)" href="../types/#agentlightning.Dataset">Dataset</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset to train on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_dataset</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            agentlightning.Dataset (agentlightning.types.Dataset)" href="../types/#agentlightning.Dataset">Dataset</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset to validate on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the configured algorithm is not a :class:<code>FastAlgorithm</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>agentlightning/trainer/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="k">def</span><span class="w"> </span><span class="nf">dev</span><span class="p">(</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="n">agent</span><span class="p">:</span> <span class="n">LitAgent</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Dry run the training loop with a FastAlgorithm and the real runner.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        agent: The LitAgent instance to be trained on.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        train_dataset: The dataset to train on.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        val_dataset: The dataset to validate on.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        TypeError: If the configured algorithm is not a :class:`FastAlgorithm`.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">agent</span><span class="o">.</span><span class="n">set_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="c1"># Sanity check</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">()</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">FastAlgorithm</span><span class="p">):</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="s2">&quot;Trainer.dev() requires an algorithm that inherits from FastAlgorithm. &quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">algorithm_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_bundle</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">runner_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_runner_bundle</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">algorithm_bundle</span><span class="p">,</span> <span class="n">runner_bundle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="agentlightning.Trainer.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">train_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">val_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#agentlightning.Trainer.fit" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Run the training loop using the configured strategy, store, and runner.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            agentlightning.LitAgent (agentlightning.litagent.LitAgent)" href="../agent/#agentlightning.LitAgent">LitAgent</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LitAgent instance to be trained on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_dataset</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            agentlightning.Dataset (agentlightning.types.Dataset)" href="../types/#agentlightning.Dataset">Dataset</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset to train on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_dataset</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            agentlightning.Dataset (agentlightning.types.Dataset)" href="../types/#agentlightning.Dataset">Dataset</a>[<span title="agentlightning.trainer.trainer.T_co">T_co</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset to validate on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>agentlightning/trainer/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="n">agent</span><span class="p">:</span> <span class="n">LitAgent</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the training loop using the configured strategy, store, and runner.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        agent: The LitAgent instance to be trained on.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        train_dataset: The dataset to train on.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        val_dataset: The dataset to validate on.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">agent</span><span class="o">.</span><span class="n">set_trainer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">algorithm_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_bundle</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="n">runner_bundle</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_runner_bundle</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">algorithm_bundle</span><span class="p">,</span> <span class="n">runner_bundle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agentlightning.build_component" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">agentlightning</span><span class="o">.</span><span class="n">build_component</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional_defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dict_requires_type</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dict_default_cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invalid_spec_error_fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">registry</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#agentlightning.build_component" class="headerlink" title="Permanent link">&para;</a></h2>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">build_component</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="p">],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">expected_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">spec_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OptionalDefaults</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">dict_requires_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">dict_default_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">type_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">invalid_spec_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">build_component</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="p">],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">expected_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">spec_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">default_factory</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OptionalDefaults</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">dict_requires_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">dict_default_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">type_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">invalid_spec_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">build_component</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="p">],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">expected_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">spec_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">default_factory</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OptionalDefaults</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">dict_requires_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">dict_default_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">type_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">invalid_spec_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>          </div>


    <div class="doc doc-contents first">

        <p>Build and return a component instance from a flexible specification.</p>
<p>This function provides a flexible way to create component instances from various
input formats including direct instances, class types, factory functions, import
paths, or configuration dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>spec</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="agentlightning.trainer.init_utils.T">T</span>, <span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>], <span title="type">type</span>[<span title="agentlightning.trainer.init_utils.T">T</span>], <span title="typing.Callable">Callable</span>[[], <span title="agentlightning.trainer.init_utils.T">T</span>], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component specification. Can be:
- An instance of expected_type (returned as-is)
- A string import path (e.g., 'module.Class') or registry key
- A dict with 'type' key (import path or registry key) and constructor kwargs
- A class type (will be instantiated)
- A factory function (will be called)
- None (uses default_factory or returns None if allow_none=True)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expected_type</code>
            </td>
            <td>
                  <code><span title="type">type</span>[<span title="agentlightning.trainer.init_utils.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type that the resulting instance must be or inherit from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spec_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Descriptive name for the spec, used in error messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_factory</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[], <span title="agentlightning.trainer.init_utils.T">T</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional factory function called when spec is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_none</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, allows None to be returned when spec is None and
no default_factory is provided.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optional_defaults</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="agentlightning.trainer.init_utils.OptionalDefaults">OptionalDefaults</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping parameter names to default values or factory
functions that will be injected if the constructor accepts them.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dict_requires_type</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, dict specs must include a 'type' key.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dict_default_cls</code>
            </td>
            <td>
                  <code><span title="type">type</span>[<span title="agentlightning.trainer.init_utils.T">T</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default class to use for dict specs without a 'type' key
(only used when dict_requires_type=False).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>type_error_fmt</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom format string for type validation errors. Should include
{type_name} and {expected_type} placeholders.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>invalid_spec_error_fmt</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom format string for invalid spec type errors.
Should include {actual_type} and {expected_type} placeholders.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>registry</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mapping of short names to fully qualified import paths.
When provided, string specs or dict 'type'/'name' entries are first
resolved through this registry before attempting to import.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="agentlightning.trainer.init_utils.T">T</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of expected_type, or None if allow_none=True and spec is None</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="agentlightning.trainer.init_utils.T">T</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>without a default_factory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the instantiated object is not an instance of expected_type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If spec is None and neither default_factory nor allow_none is set,
or if spec type is invalid, or if dict spec is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Direct instance</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">build_component</span><span class="p">(</span><span class="n">AdamW</span><span class="p">(),</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Optimizer</span><span class="p">,</span> <span class="n">spec_name</span><span class="o">=</span><span class="s1">&#39;optimizer&#39;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># String import path</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">build_component</span><span class="p">(</span><span class="s1">&#39;torch.optim.AdamW&#39;</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Optimizer</span><span class="p">,</span> <span class="n">spec_name</span><span class="o">=</span><span class="s1">&#39;optimizer&#39;</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Dict with type and kwargs</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;torch.optim.AdamW&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">}</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">build_component</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Optimizer</span><span class="p">,</span> <span class="n">spec_name</span><span class="o">=</span><span class="s1">&#39;optimizer&#39;</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Class type</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">build_component</span><span class="p">(</span><span class="n">AdamW</span><span class="p">,</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Optimizer</span><span class="p">,</span> <span class="n">spec_name</span><span class="o">=</span><span class="s1">&#39;optimizer&#39;</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Factory function</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">build_component</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">AdamW</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">... </span>                           <span class="n">spec_name</span><span class="o">=</span><span class="s1">&#39;optimizer&#39;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>agentlightning/trainer/init_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_component</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">expected_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">spec_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">optional_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OptionalDefaults</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="n">dict_requires_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="n">dict_default_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">type_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">invalid_spec_error_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Build and return a component instance from a flexible specification.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    This function provides a flexible way to create component instances from various</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    input formats including direct instances, class types, factory functions, import</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    paths, or configuration dictionaries.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        spec: The component specification. Can be:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            - An instance of expected_type (returned as-is)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">            - A string import path (e.g., &#39;module.Class&#39;) or registry key</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">            - A dict with &#39;type&#39; key (import path or registry key) and constructor kwargs</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">            - A class type (will be instantiated)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">            - A factory function (will be called)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">            - None (uses default_factory or returns None if allow_none=True)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        expected_type: The type that the resulting instance must be or inherit from.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        spec_name: Descriptive name for the spec, used in error messages.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        default_factory: Optional factory function called when spec is None.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        allow_none: If True, allows None to be returned when spec is None and</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            no default_factory is provided.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        optional_defaults: Dict mapping parameter names to default values or factory</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">            functions that will be injected if the constructor accepts them.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        dict_requires_type: If True, dict specs must include a &#39;type&#39; key.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        dict_default_cls: Default class to use for dict specs without a &#39;type&#39; key</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">            (only used when dict_requires_type=False).</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        type_error_fmt: Custom format string for type validation errors. Should include</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            {type_name} and {expected_type} placeholders.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        invalid_spec_error_fmt: Custom format string for invalid spec type errors.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">            Should include {actual_type} and {expected_type} placeholders.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        registry: Optional mapping of short names to fully qualified import paths.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            When provided, string specs or dict &#39;type&#39;/&#39;name&#39; entries are first</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            resolved through this registry before attempting to import.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        An instance of expected_type, or None if allow_none=True and spec is None</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        without a default_factory.</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        TypeError: If the instantiated object is not an instance of expected_type.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        ValueError: If spec is None and neither default_factory nor allow_none is set,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            or if spec type is invalid, or if dict spec is invalid.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &gt;&gt;&gt; # Direct instance</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        &gt;&gt;&gt; optimizer = build_component(AdamW(), expected_type=Optimizer, spec_name=&#39;optimizer&#39;)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        &gt;&gt;&gt; # String import path</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        &gt;&gt;&gt; optimizer = build_component(&#39;torch.optim.AdamW&#39;, expected_type=Optimizer, spec_name=&#39;optimizer&#39;)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        &gt;&gt;&gt; # Dict with type and kwargs</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        &gt;&gt;&gt; spec = {&#39;type&#39;: &#39;torch.optim.AdamW&#39;, &#39;lr&#39;: 0.001}</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        &gt;&gt;&gt; optimizer = build_component(spec, expected_type=Optimizer, spec_name=&#39;optimizer&#39;)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        &gt;&gt;&gt; # Class type</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        &gt;&gt;&gt; optimizer = build_component(AdamW, expected_type=Optimizer, spec_name=&#39;optimizer&#39;)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        &gt;&gt;&gt; # Factory function</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        &gt;&gt;&gt; optimizer = build_component(lambda: AdamW(lr=0.001), expected_type=Optimizer,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        ...                            spec_name=&#39;optimizer&#39;)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="n">default_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">instance</span> <span class="o">=</span> <span class="n">default_factory</span><span class="p">()</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="k">return</span> <span class="n">_ensure_expected_type</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">invalid_spec_error_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual_type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">expected_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">if</span> <span class="n">invalid_spec_error_fmt</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spec_name</span><span class="si">}</span><span class="s2"> cannot be None.&quot;</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">):</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">instance</span> <span class="o">=</span> <span class="n">instantiate_component</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">return</span> <span class="n">_ensure_expected_type</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">instance</span> <span class="o">=</span> <span class="n">spec</span><span class="p">()</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">return</span> <span class="n">_ensure_expected_type</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">instance</span> <span class="o">=</span> <span class="n">instantiate_from_spec</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">spec</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="n">spec_name</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">dict_requires_type</span><span class="o">=</span><span class="n">dict_requires_type</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">dict_default_cls</span><span class="o">=</span><span class="n">dict_default_cls</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">registry</span><span class="o">=</span><span class="n">registry</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">return</span> <span class="n">_ensure_expected_type</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">instance</span> <span class="o">=</span> <span class="n">instantiate_from_spec</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">spec</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">spec_name</span><span class="o">=</span><span class="n">spec_name</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">optional_defaults</span><span class="o">=</span><span class="n">optional_defaults</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">dict_requires_type</span><span class="o">=</span><span class="n">dict_requires_type</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">dict_default_cls</span><span class="o">=</span><span class="n">dict_default_cls</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">registry</span><span class="o">=</span><span class="n">registry</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">return</span> <span class="n">_ensure_expected_type</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">,</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">type_error_fmt</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="n">invalid_spec_error_fmt</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">invalid_spec_error_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual_type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span> <span class="n">expected_type</span><span class="o">=</span><span class="n">expected_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">spec_name</span><span class="si">}</span><span class="s2"> type: </span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">. Expected </span><span class="si">{</span><span class="n">expected_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, str, dict, or None.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="execution-strategy">Execution Strategy<a class="headerlink" href="#execution-strategy" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="agentlightning.ExecutionStrategy" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.ExecutionStrategy</code>


<a href="#agentlightning.ExecutionStrategy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>When trainer has created the executable of algorithm and runner in two bundles,
the execution strategy defines how to run them together, and how many parallel runners to run.</p>
<p>The store is the centric place for the two bundles to communicate.</p>
<p>The algorithm and runner's behavior (whether runner should perform one step or run forever,
whether the algo would send out the tasks or not) are defined inside the bundle,
and does not belong to the execution strategy.</p>
<p>The execute should support Ctrl+C to exit gracefully.</p>








              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionStrategy</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;When trainer has created the executable of algorithm and runner in two bundles,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    the execution strategy defines how to run them together, and how many parallel runners to run.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    The store is the centric place for the two bundles to communicate.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    The algorithm and runner&#39;s behavior (whether runner should perform one step or run forever,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    whether the algo would send out the tasks or not) are defined inside the bundle,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    and does not belong to the execution strategy.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    The execute should support Ctrl+C to exit gracefully.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agentlightning.ClientServerExecutionStrategy" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.ClientServerExecutionStrategy</code>


<a href="#agentlightning.ClientServerExecutionStrategy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            agentlightning.ExecutionStrategy (agentlightning.execution.base.ExecutionStrategy)" href="#agentlightning.ExecutionStrategy">ExecutionStrategy</a></code></p>


        <p>Run algorithm (server) and runners (clients) as separate processes over HTTP.</p>
<p><strong>Execution Roles:</strong></p>
<ul>
<li>"algorithm": Start the HTTP server (<code>LightningStoreServer</code>) in-process and run the
  algorithm bundle against it.</li>
<li>"runner": Connect to an already running server via <code>LightningStoreClient</code> and
  execute runner bundles (optionally in multiple processes).</li>
<li>"both": Spawn the runner processes first, then launch the algorithm/server
  bundle on the main process. This mode orchestrates the full loop locally.</li>
</ul>
<p>When role == "both", you may choose which side runs on the main process via
<code>main_process</code> (debug helper). Running the runner bundle on the main process
is only supported with <code>n_runners == 1</code>.</p>
<p>Important: When <code>main_process == "runner"</code>, the algorithm runs in a subprocess
with the LightningStore server. This means any state modifications made during
execution remain in that subprocess and are NOT reflected in the original store
object passed to <code>execute()</code>. The main process runner accesses the store only
through the HTTP client interface.</p>
<p><strong>Abort / Stop Model (four-step escalation):</strong></p>
<ol>
<li>Cooperative stop:
   A shared :class:<code>~agentlightning.execution.events.MultiprocessingEvent</code>
   (<code>stop_evt</code>) is passed to <em>all</em> bundles. Bundles should check it to exit.
   Any crash (algorithm or runner) sets <code>stop_evt</code> so the other side can
   stop cooperatively. Ctrl+C on the main process also flips the event.</li>
<li>KeyboardInterrupt synth:
   Remaining subprocesses receive <code>SIGINT</code> to trigger <code>KeyboardInterrupt</code>
   handlers.</li>
<li>Termination:
   Stubborn subprocesses get <code>terminate()</code> (SIGTERM on POSIX).</li>
<li>Kill:
    As a last resort we call <code>kill()</code> (SIGKILL on POSIX).</li>
</ol>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This mirrors the semantics implemented in :mod:<code>shared_memory</code>, but adapted
to multiple processes and the HTTP client/server boundary.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/client_server.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClientServerExecutionStrategy</span><span class="p">(</span><span class="n">ExecutionStrategy</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run algorithm (server) and runners (clients) as separate processes over HTTP.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    **Execution Roles:**</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    - &quot;algorithm&quot;: Start the HTTP server (`LightningStoreServer`) in-process and run the</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">      algorithm bundle against it.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    - &quot;runner&quot;: Connect to an already running server via `LightningStoreClient` and</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">      execute runner bundles (optionally in multiple processes).</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    - &quot;both&quot;: Spawn the runner processes first, then launch the algorithm/server</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">      bundle on the main process. This mode orchestrates the full loop locally.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    When role == &quot;both&quot;, you may choose which side runs on the main process via</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    `main_process` (debug helper). Running the runner bundle on the main process</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    is only supported with `n_runners == 1`.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Important: When `main_process == &quot;runner&quot;`, the algorithm runs in a subprocess</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    with the LightningStore server. This means any state modifications made during</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    execution remain in that subprocess and are NOT reflected in the original store</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    object passed to `execute()`. The main process runner accesses the store only</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    through the HTTP client interface.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    **Abort / Stop Model (four-step escalation):**</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    1. Cooperative stop:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">       A shared :class:`~agentlightning.execution.events.MultiprocessingEvent`</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">       (`stop_evt`) is passed to *all* bundles. Bundles should check it to exit.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">       Any crash (algorithm or runner) sets `stop_evt` so the other side can</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">       stop cooperatively. Ctrl+C on the main process also flips the event.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    2. KeyboardInterrupt synth:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">       Remaining subprocesses receive `SIGINT` to trigger `KeyboardInterrupt`</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">       handlers.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    3. Termination:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">       Stubborn subprocesses get `terminate()` (SIGTERM on POSIX).</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    4. Kill:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        As a last resort we call `kill()` (SIGKILL on POSIX).</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        This mirrors the semantics implemented in :mod:`shared_memory`, but adapted</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        to multiple processes and the HTTP client/server boundary.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cs&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">server_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">server_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">n_runners</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">graceful_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">terminate_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">main_process</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the strategy.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            role: Which side(s) to run in this process. When omitted, the</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                :envvar:`AGL_CURRENT_ROLE` environment variable is used.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            server_host: Interface the HTTP server binds to when running the</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                algorithm bundle locally. Defaults to :envvar:`AGL_SERVER_HOST`</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">                or ``&quot;localhost&quot;`` if unset.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            server_port: Port for the HTTP server in &quot;algorithm&quot;/&quot;both&quot; modes.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                Defaults to :envvar:`AGL_SERVER_PORT` or ``4747`` if unset.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            n_runners: Number of runner processes to spawn in &quot;runner&quot;/&quot;both&quot;.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            graceful_timeout: How long to wait (seconds) after setting the stop</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                event before escalating to signals.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            terminate_timeout: How long to wait between escalation steps beyond</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                the cooperative phase (re-used for SIGINT, terminate, and kill).</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            main_process: Which bundle runs on the main process when</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                `role == &quot;both&quot;`. `&quot;runner&quot;` requires `n_runners == 1` and is</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">                primarily intended for debugging.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">role_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_CURRENT_ROLE&quot;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">if</span> <span class="n">role_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;role must be provided via argument or AGL_CURRENT_ROLE env var&quot;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="k">if</span> <span class="n">role_env</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;role must be one of &#39;algorithm&#39;, &#39;runner&#39;, or &#39;both&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">role</span> <span class="o">=</span> <span class="n">role_env</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="k">if</span> <span class="n">server_host</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">server_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="n">server_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">server_port_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_PORT&quot;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">if</span> <span class="n">server_port_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="n">server_port</span> <span class="o">=</span> <span class="mi">4747</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                    <span class="n">server_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">server_port_env</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_PORT must be an integer&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">=</span> <span class="n">n_runners</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="n">server_host</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">server_port</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graceful_timeout</span> <span class="o">=</span> <span class="n">graceful_timeout</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_timeout</span> <span class="o">=</span> <span class="n">terminate_timeout</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">if</span> <span class="n">main_process</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process must be &#39;algorithm&#39; or &#39;runner&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">if</span> <span class="n">main_process</span> <span class="o">==</span> <span class="s2">&quot;runner&quot;</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="k">if</span> <span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process=&#39;runner&#39; is only supported when role=&#39;both&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="k">if</span> <span class="n">n_runners</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process=&#39;runner&#39; requires n_runners to be 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_process</span> <span class="o">=</span> <span class="n">main_process</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_execute_algorithm</span><span class="p">(</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting LightningStore server on </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">server_store</span> <span class="o">=</span> <span class="n">LightningStoreServer</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">server_started</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">server_store</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">server_started</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle starting against endpoint </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">server_store</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">await</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">server_store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Algorithm received KeyboardInterrupt; signaling stop event&quot;</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="k">raise</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle crashed; signaling stop event&quot;</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">raise</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="k">if</span> <span class="n">server_started</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="k">await</span> <span class="n">server_store</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error stopping LightningStore server&quot;</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LightningStore server shutdown completed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_execute_runner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">client_store</span> <span class="o">=</span> <span class="n">LightningStoreClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Runner </span><span class="si">%s</span><span class="s2"> connecting to server at </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">await</span> <span class="n">runner</span><span class="p">(</span><span class="n">client_store</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Runner </span><span class="si">%s</span><span class="s2"> completed successfully&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Runner </span><span class="si">%s</span><span class="s2"> received KeyboardInterrupt; signaling stop event&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">raise</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Runner </span><span class="si">%s</span><span class="s2"> crashed; signaling stop event&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">raise</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="k">await</span> <span class="n">client_store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error closing LightningStore client for runner </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Runner </span><span class="si">%s</span><span class="s2"> closed LightningStore client&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_spawn_runners</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">ctx</span><span class="p">:</span> <span class="n">BaseContext</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">]:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Used when `role == &quot;runner&quot;` or `role == &quot;both&quot;` and `n_runners &gt; 1`.&quot;&quot;&quot;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_runner_sync</span><span class="p">(</span><span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="c1"># Runners are executed in child processes; each process owns its own</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="c1"># event loop to keep the asyncio scheduler isolated.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_runner</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">ctx</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_runner_sync</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;runner-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Spawned runner process </span><span class="si">%s</span><span class="s2"> (pid=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">return</span> <span class="n">processes</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_spawn_algorithm_process</span><span class="p">(</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">ctx</span><span class="p">:</span> <span class="n">BaseContext</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Used when `main_process == &quot;runner&quot;`.&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_algorithm_sync</span><span class="p">(</span><span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">ctx</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_algorithm_sync</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;algorithm&quot;</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Spawned algorithm process </span><span class="si">%s</span><span class="s2"> (pid=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">return</span> <span class="n">process</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_join_until_deadline</span><span class="p">(</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">processes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">],</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">]:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Join ``processes`` until ``timeout`` elapses, returning those still alive.&quot;&quot;&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">deadline</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">still_alive</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">remaining</span> <span class="o">=</span> <span class="n">deadline</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">still_alive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="k">return</span> <span class="n">still_alive</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_signal_processes</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">processes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">],</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke ``action`` on each process while suppressing individual failures.&quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">action</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error signaling process </span><span class="si">%s</span><span class="s2"> (pid=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_shutdown_processes</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">],</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;4-step escalation shutdown of ``processes``.&quot;&quot;&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">processes</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No subprocesses to shutdown&quot;</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">return</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">stop_evt</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sending cooperative stop signal to subprocesses&quot;</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stop event already set; waiting for subprocesses to exit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_until_deadline</span><span class="p">(</span><span class="n">processes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graceful_timeout</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">alive</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="k">return</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="s2">&quot;Subprocesses still alive after cooperative wait; sending SIGINT to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">),</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="c1"># SIGINT is not reliable on Windows, but we do not consider such case yet.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_processes</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="p">),</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">))</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_until_deadline</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_timeout</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">alive</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="k">return</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="s2">&quot;Subprocesses still alive after SIGINT wait; sending terminate() to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">),</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_processes</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">terminate</span><span class="p">())</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_until_deadline</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_timeout</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">alive</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">return</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="s2">&quot;Subprocesses still alive after terminate(); sending kill() to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">),</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_processes</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">kill</span><span class="p">())</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_until_deadline</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_timeout</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="k">if</span> <span class="n">alive</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="s2">&quot;Subprocesses failed to exit even after kill(): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_process_exitcodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an error if any managed process exited with a non-zero status.&quot;&quot;&quot;</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">exitcode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s2"> (exitcode=</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">exitcode</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subprocesses failed: </span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="s2">&quot;Starting client-server execution with </span><span class="si">%d</span><span class="s2"> runner(s) [role=</span><span class="si">%s</span><span class="s2">, main_process=</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">main_process</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="c1"># Re-use the active multiprocessing context so the event and processes</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="c1"># agree on the start method (fork/spawn/forkserver).</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">stop_evt</span> <span class="o">=</span> <span class="n">MultiprocessingEvent</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="c1"># Track spawned processes so we can enforce termination ordering and</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="c1"># surface non-zero exit codes back to the caller.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">exception</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">keyboard_interrupt</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running algorithm solely...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;runner&quot;</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running runner solely...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_runner</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Spawning runner processes...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                    <span class="n">processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spawn_runners</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                    <span class="c1"># Wait for the processes to finish naturally.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                    <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                        <span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_process_exitcodes</span><span class="p">(</span><span class="n">processes</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_process</span> <span class="o">==</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Spawning runner processes...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                    <span class="n">processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spawn_runners</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running algorithm...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                        <span class="c1"># Always request the runner side to unwind once the</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                        <span class="c1"># algorithm/server portion finishes (successfully or not).</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                        <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># main_process == &quot;runner&quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process=&#39;runner&#39; requires n_runners to be 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Spawning algorithm process...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                    <span class="n">algorithm_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spawn_algorithm_process</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                    <span class="n">processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">algorithm_process</span><span class="p">]</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                    <span class="c1"># Run the lone runner cooperatively in-process so users can</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                    <span class="c1"># attach a debugger. The algorithm + HTTP server live in</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                    <span class="c1"># the background process spawned above (the provided</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                    <span class="c1"># store must therefore be picklable when using spawn).</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running runner...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_runner</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                    <span class="c1"># Wait for the algorithm process to finish.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                    <span class="n">algorithm_process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown role: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;KeyboardInterrupt received; initiating shutdown&quot;</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">keyboard_interrupt</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unhandled exception in execute method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="c1"># Preserve the original exception so we can avoid masking it during</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="c1"># the cleanup phase.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">exception</span> <span class="o">=</span> <span class="n">exc</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="k">raise</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shutting down subprocesses&quot;</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_processes</span><span class="p">(</span><span class="n">processes</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="k">if</span> <span class="n">processes</span><span class="p">:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_process_exitcodes</span><span class="p">(</span><span class="n">processes</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                    <span class="k">if</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">keyboard_interrupt</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                        <span class="c1"># We already propagate/handled a different failure, so</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                        <span class="c1"># emit a warning instead of raising a secondary error.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Subprocesses ended abnormally during shutdown: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="agentlightning.ClientServerExecutionStrategy.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server_host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_runners</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">graceful_timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">terminate_timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">main_process</span><span class="o">=</span><span class="s1">&#39;algorithm&#39;</span><span class="p">)</span></code>

<a href="#agentlightning.ClientServerExecutionStrategy.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Configure the strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>role</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;algorithm&#39;, &#39;runner&#39;, &#39;both&#39;] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which side(s) to run in this process. When omitted, the
:envvar:<code>AGL_CURRENT_ROLE</code> environment variable is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>server_host</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interface the HTTP server binds to when running the
algorithm bundle locally. Defaults to :envvar:<code>AGL_SERVER_HOST</code>
or <code>"localhost"</code> if unset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>server_port</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Port for the HTTP server in "algorithm"/"both" modes.
Defaults to :envvar:<code>AGL_SERVER_PORT</code> or <code>4747</code> if unset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_runners</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of runner processes to spawn in "runner"/"both".</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graceful_timeout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How long to wait (seconds) after setting the stop
event before escalating to signals.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminate_timeout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How long to wait between escalation steps beyond
the cooperative phase (re-used for SIGINT, terminate, and kill).</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_process</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;algorithm&#39;, &#39;runner&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which bundle runs on the main process when
<code>role == "both"</code>. <code>"runner"</code> requires <code>n_runners == 1</code> and is
primarily intended for debugging.</p>
              </div>
            </td>
            <td>
                  <code>&#39;algorithm&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>agentlightning/execution/client_server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">role</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">server_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">server_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">n_runners</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">graceful_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">terminate_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">main_process</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure the strategy.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        role: Which side(s) to run in this process. When omitted, the</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            :envvar:`AGL_CURRENT_ROLE` environment variable is used.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        server_host: Interface the HTTP server binds to when running the</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            algorithm bundle locally. Defaults to :envvar:`AGL_SERVER_HOST`</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            or ``&quot;localhost&quot;`` if unset.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        server_port: Port for the HTTP server in &quot;algorithm&quot;/&quot;both&quot; modes.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            Defaults to :envvar:`AGL_SERVER_PORT` or ``4747`` if unset.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        n_runners: Number of runner processes to spawn in &quot;runner&quot;/&quot;both&quot;.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        graceful_timeout: How long to wait (seconds) after setting the stop</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            event before escalating to signals.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        terminate_timeout: How long to wait between escalation steps beyond</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            the cooperative phase (re-used for SIGINT, terminate, and kill).</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        main_process: Which bundle runs on the main process when</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            `role == &quot;both&quot;`. `&quot;runner&quot;` requires `n_runners == 1` and is</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            primarily intended for debugging.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">role_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_CURRENT_ROLE&quot;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">if</span> <span class="n">role_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;role must be provided via argument or AGL_CURRENT_ROLE env var&quot;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">if</span> <span class="n">role_env</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;role must be one of &#39;algorithm&#39;, &#39;runner&#39;, or &#39;both&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">role</span> <span class="o">=</span> <span class="n">role_env</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="n">server_host</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">server_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">server_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">server_port_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_PORT&quot;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">server_port_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">server_port</span> <span class="o">=</span> <span class="mi">4747</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="n">server_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">server_port_env</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;AGL_SERVER_PORT must be an integer&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">=</span> <span class="n">n_runners</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="n">server_host</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">server_port</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">graceful_timeout</span> <span class="o">=</span> <span class="n">graceful_timeout</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">terminate_timeout</span> <span class="o">=</span> <span class="n">terminate_timeout</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="k">if</span> <span class="n">main_process</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process must be &#39;algorithm&#39; or &#39;runner&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">if</span> <span class="n">main_process</span> <span class="o">==</span> <span class="s2">&quot;runner&quot;</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">if</span> <span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process=&#39;runner&#39; is only supported when role=&#39;both&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="n">n_runners</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_process=&#39;runner&#39; requires n_runners to be 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_process</span> <span class="o">=</span> <span class="n">main_process</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agentlightning.SharedMemoryExecutionStrategy" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.SharedMemoryExecutionStrategy</code>


<a href="#agentlightning.SharedMemoryExecutionStrategy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            agentlightning.ExecutionStrategy (agentlightning.execution.base.ExecutionStrategy)" href="#agentlightning.ExecutionStrategy">ExecutionStrategy</a></code></p>


        <p>Run algorithm and runners in a single process with threads sharing memory.</p>
<p>Termination &amp; abort model:</p>
<ul>
<li>One shared ThreadingEvent (<code>stop_evt</code>) is passed to <em>all</em> bundles.</li>
<li>The main thread (only) receives KeyboardInterrupt on Ctrl+C; we set <code>stop_evt</code> there.</li>
<li>If any bundle raises, we set <code>stop_evt</code> from that thread to stop the rest.</li>
<li>After the main-thread bundle finishes normally:</li>
<li>If main_thread is "algorithm", we also set <code>stop_evt</code> to stop the runners.</li>
<li>If main_thread is "runner", we do not set <code>stop_evt</code> to stop the algorithm.
    We instead wait for the algorithm to finish naturally.</li>
<li>Background threads are daemons; we join briefly and log any stragglers.</li>
</ul>
<p>Notes: Signals other than SIGINT (e.g., SIGTERM) are not intercepted; we respect
Python's default behavior for them.</p>








              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/shared_memory.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">SharedMemoryExecutionStrategy</span><span class="p">(</span><span class="n">ExecutionStrategy</span><span class="p">):</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run algorithm and runners in a single process with threads sharing memory.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Termination &amp; abort model:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    - One shared ThreadingEvent (`stop_evt`) is passed to *all* bundles.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    - The main thread (only) receives KeyboardInterrupt on Ctrl+C; we set `stop_evt` there.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    - If any bundle raises, we set `stop_evt` from that thread to stop the rest.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    - After the main-thread bundle finishes normally:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">      - If main_thread is &quot;algorithm&quot;, we also set `stop_evt` to stop the runners.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">      - If main_thread is &quot;runner&quot;, we do not set `stop_evt` to stop the algorithm.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        We instead wait for the algorithm to finish naturally.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    - Background threads are daemons; we join briefly and log any stragglers.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Notes: Signals other than SIGINT (e.g., SIGTERM) are not intercepted; we respect</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Python&#39;s default behavior for them.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;shm&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">n_runners</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">main_thread</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;runner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">join_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">graceful_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">if</span> <span class="n">main_thread</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span> <span class="s2">&quot;runner&quot;</span><span class="p">):</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;main_thread must be &#39;algorithm&#39; or &#39;runner&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">if</span> <span class="n">main_thread</span> <span class="o">==</span> <span class="s2">&quot;runner&quot;</span> <span class="ow">and</span> <span class="n">n_runners</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When main_thread is &#39;runner&#39;, n_runners must be 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span> <span class="o">=</span> <span class="n">n_runners</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_thread</span> <span class="o">=</span> <span class="n">main_thread</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">join_timeout</span> <span class="o">=</span> <span class="n">join_timeout</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graceful_delay</span> <span class="o">=</span> <span class="n">graceful_delay</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poll_interval</span> <span class="o">=</span> <span class="n">poll_interval</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run_until_completed_or_canceled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">:</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run `coro` until it finishes or a cooperative stop is requested.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Control flow:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">          1) Start the bundle coroutine as `task`.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">          2) Start a watcher task that waits for `stop_evt` *without blocking* the loop</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">             by periodically polling the threading event.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">          3) When the stop event flips:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">               a) Give the bundle *graceful_delay* seconds to finish on its own,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                  because well-behaved bundles will check the event and return.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">               b) If still running after the grace period, cancel the bundle task.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">          4) Ensure both tasks are awaited; swallow `CancelledError` where appropriate.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        This is a *backup* mechanism for bundles that might not poll the event</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        frequently; cooperative shutdown (checking `stop_evt` yourself) is still preferred.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">task</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">task_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">watcher</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="c1"># Poll the threading event without blocking the event loop. Using a</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="c1"># background thread via ``asyncio.to_thread`` makes cancellation</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="c1"># difficult because ``ThreadingEvent.wait`` is not interruptible.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="c1"># Instead we cooperatively check the flag from the loop so the</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="c1"># watcher task stays cancellable and tests don&#39;t hang when the</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="c1"># bundle finishes naturally before the stop event is set.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_evt</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_interval</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="c1"># Grace period: let a cooperative bundle exit on its own.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="c1"># At this point of waiting, the main task should already see the stop event.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">shield</span><span class="p">(</span><span class="n">task</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graceful_delay</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Bundle finished by itself during grace period.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="k">return</span>  <span class="c1"># bundle finished by itself during grace period</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="c1"># Still running after the grace window.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="k">pass</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="c1"># If someone else canceled the task already, we&#39;re done.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Bundle already canceled by someone else; exiting watcher.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="k">return</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="c1"># Still running after the grace window: cancel it.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Graceful delay elapsed; canceling bundle task...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">watcher_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">watcher</span><span class="p">())</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="c1"># We don&#39;t wait on FIRST_COMPLETED here, because we want the watcher</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="c1"># to be able to grant a grace window after stop_evt flips.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="p">{</span><span class="n">task</span><span class="p">,</span> <span class="n">watcher_task</span><span class="p">},</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="p">)</span>  <span class="c1"># pyright: ignore[reportUnknownArgumentType]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="c1"># If the main task hasn&#39;t completed yet (e.g., watcher scheduled cancel),</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="c1"># finish the cancellation handshake.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graceful_delay</span><span class="p">)</span>  <span class="c1"># second chance</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                        <span class="s2">&quot;Bundle task did not stop after cancellation; abandoning task.&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                        <span class="s2">&quot;This thread could live until the process exits.&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                    <span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="c1"># We return without awaiting it. asyncio.run will still try to cancel</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                    <span class="c1"># pending tasks on loop close; if the task ignores cancellation, this</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                    <span class="c1"># thread may still stick. It&#39;s the best we can do in Python.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                    <span class="c1"># We don&#39;t raise an exception here, but the thread could be a zombie.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                    <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="c1"># Task completed naturally; retrieve result.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                    <span class="k">pass</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                    <span class="n">task_exception</span> <span class="o">=</span> <span class="n">exc</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">watcher_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="k">await</span> <span class="n">watcher_task</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">if</span> <span class="n">task_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">raise</span> <span class="n">task_exception</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">return</span> <span class="n">result</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_algorithm</span><span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">thread_exceptions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleQueue</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_until_completed_or_canceled</span><span class="p">(</span><span class="n">algorithm</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">),</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle canceled due to stop signal.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Algorithm bundle crashed; signaling stop to others.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">if</span> <span class="n">thread_exceptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">raise</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_runner</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">worker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">stop_evt</span><span class="p">:</span> <span class="n">ExecutionEvent</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">thread_exceptions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleQueue</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_until_completed_or_canceled</span><span class="p">(</span><span class="n">runner</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">),</span> <span class="n">stop_evt</span><span class="p">))</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Runner bundle (worker_id=</span><span class="si">%s</span><span class="s2">) canceled due to stop signal.&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Runner bundle crashed (worker_id=</span><span class="si">%s</span><span class="s2">); signaling stop to others.&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="k">if</span> <span class="n">thread_exceptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="k">raise</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">AlgorithmBundle</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">RunnerBundle</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">LightningStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="s2">&quot;Starting shm execution with </span><span class="si">%d</span><span class="s2"> runner(s); main thread runs &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">main_thread</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="c1"># Create stop event and thread-safe store.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="n">stop_evt</span> <span class="o">=</span> <span class="n">ThreadingEvent</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">thread_safe_store</span> <span class="o">=</span> <span class="n">LightningStoreThreaded</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">thread_exceptions</span><span class="p">:</span> <span class="n">SimpleQueue</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleQueue</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">raised_from_thread</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">make_thread</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">return</span> <span class="n">t</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">threads</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_thread</span> <span class="o">==</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="c1"># Start runner threads; algorithm runs on main thread.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_runners</span><span class="p">):</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                    <span class="n">thread</span> <span class="o">=</span> <span class="n">make_thread</span><span class="p">(</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;runner-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_runner</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">thread_safe_store</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="n">thread_exceptions</span><span class="p">),</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                    <span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="c1"># Ctrl+C here raises KeyboardInterrupt on this stack.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="c1"># Main thread doesn&#39;t need to collect exceptions.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">thread_safe_store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="c1"># If algo finishes naturally, request runners to stop.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># main_thread == &quot;runner&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="c1"># Start algorithm in background; runner runs on main thread.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">thread</span> <span class="o">=</span> <span class="n">make_thread</span><span class="p">(</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                    <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithm</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">thread_safe_store</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="n">thread_exceptions</span><span class="p">),</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="c1"># Ctrl+C here raises KeyboardInterrupt on this stack.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="c1"># Main thread doesn&#39;t need to collect exceptions.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_run_runner</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">thread_safe_store</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stop_evt</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="c1"># If runner finishes naturally, WAIT FOR ALGORITHM TO FINISH.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">raised_from_thread</span> <span class="o">=</span> <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;KeyboardInterrupt received on main thread; initiating cooperative shutdown...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">stop_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="c1"># Attempt a clean join; if some threads don&#39;t comply, log and move on.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Joining thread </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">join_timeout</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">alive</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()]</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="k">if</span> <span class="n">alive</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                    <span class="s2">&quot;Threads still alive after </span><span class="si">%.1f</span><span class="s2">s: </span><span class="si">%s</span><span class="s2">. They are daemons; continuing shutdown.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">join_timeout</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alive</span><span class="p">),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                <span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="k">if</span> <span class="n">raised_from_thread</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">raised_from_thread</span> <span class="o">=</span> <span class="n">thread_exceptions</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">if</span> <span class="n">raised_from_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">raise</span> <span class="n">raised_from_thread</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="agentlightning.ExecutionEvent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.ExecutionEvent</code>


<a href="#agentlightning.ExecutionEvent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>


        <p>A minimal protocol similar to threading.Event.</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="agentlightning.ExecutionEvent.set">set</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Signal event like a cancellation (idempotent).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="agentlightning.ExecutionEvent.clear">clear</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Reset to the non-set state.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="agentlightning.ExecutionEvent.is_set">is_set</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>True if event has been signaled.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="agentlightning.ExecutionEvent.wait">wait</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Optional[float] = None) -&gt; bool:
Block until event is set or timeout. Returns True if event has signaled.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/events.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionEvent</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    A minimal protocol similar to threading.Event.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        set(): Signal event like a cancellation (idempotent).</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        clear(): Reset to the non-set state.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        is_set() -&gt; bool: True if event has been signaled.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        wait(timeout: Optional[float] = None) -&gt; bool:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">            Block until event is set or timeout. Returns True if event has signaled.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agentlightning.ThreadingEvent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.ThreadingEvent</code>


<a href="#agentlightning.ThreadingEvent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>An Event implementation using threading.Event.</p>
<p>Provides a thread-safe event object for signaling between threads.</p>








              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/events.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadingEvent</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    An Event implementation using threading.Event.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Provides a thread-safe event object for signaling between threads.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_evt&quot;</span><span class="p">,)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agentlightning.MultiprocessingEvent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>agentlightning.MultiprocessingEvent</code>


<a href="#agentlightning.MultiprocessingEvent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>An Event implementation using multiprocessing.Event.</p>
<p>Provides a process-safe event object for signaling between processes.
Optionally accepts a multiprocessing context for custom process start methods.</p>








              <details class="quote">
                <summary>Source code in <code>agentlightning/execution/events.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultiprocessingEvent</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    An Event implementation using multiprocessing.Event.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Provides a process-safe event object for signaling between processes.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Optionally accepts a multiprocessing context for custom process start methods.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_evt&quot;</span><span class="p">,)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctx</span> <span class="ow">or</span> <span class="n">mp</span><span class="p">)</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evt</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="cli-builder">CLI Builder<a class="headerlink" href="#cli-builder" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="agentlightning.lightning_cli" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">agentlightning</span><span class="o">.</span><span class="n">lightning_cli</span><span class="p">(</span><span class="o">*</span><span class="n">classes</span><span class="p">)</span></code>

<a href="#agentlightning.lightning_cli" class="headerlink" title="Permanent link">&para;</a></h2>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">lightning_cli</span><span class="p">(</span><span class="n">cls1</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C1</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_C1</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">lightning_cli</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">cls1</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C1</span><span class="p">],</span> <span class="n">cls2</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C2</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_C1</span><span class="p">,</span> <span class="n">_C2</span><span class="p">]</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">lightning_cli</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">cls1</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C1</span><span class="p">],</span> <span class="n">cls2</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C2</span><span class="p">],</span> <span class="n">cls3</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C3</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_C1</span><span class="p">,</span> <span class="n">_C2</span><span class="p">,</span> <span class="n">_C3</span><span class="p">]</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">lightning_cli</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">cls1</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C1</span><span class="p">],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">cls2</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C2</span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">cls3</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C3</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">cls4</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_C4</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_C1</span><span class="p">,</span> <span class="n">_C2</span><span class="p">,</span> <span class="n">_C3</span><span class="p">,</span> <span class="n">_C4</span><span class="p">]</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">lightning_cli</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="n">classes</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">CliConfigurable</span><span class="p">],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CliConfigurable</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>          </div>


    <div class="doc doc-contents first">

        <p>Parses command-line arguments to configure and instantiate provided CliConfigurable classes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*classes</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="agentlightning.config.CliConfigurable">CliConfigurable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One or more classes that inherit from CliConfigurable. Each class's
      <strong>init</strong> parameters will be exposed as command-line arguments.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="agentlightning.config.CliConfigurable">CliConfigurable</span> | <span title="typing.Tuple">Tuple</span>[<span title="agentlightning.config.CliConfigurable">CliConfigurable</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple of instantiated objects, corresponding to the input classes in order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>agentlightning/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="k">def</span><span class="w"> </span><span class="nf">lightning_cli</span><span class="p">(</span><span class="o">*</span><span class="n">classes</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">CliConfigurable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CliConfigurable</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CliConfigurable</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    Parses command-line arguments to configure and instantiate provided CliConfigurable classes.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        *classes: One or more classes that inherit from CliConfigurable. Each class&#39;s</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">                  __init__ parameters will be exposed as command-line arguments.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        A tuple of instantiated objects, corresponding to the input classes in order.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">classes</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>  <span class="c1"># Return an empty tuple if no classes are provided</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">_create_argument_parser</span><span class="p">()</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="c1"># This map will store {cls: {init_param_name: argparse_dest_name}}</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">class_arg_configs_maps</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">CliConfigurable</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">_add_arguments_for_class</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">class_arg_configs_maps</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">parsed_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># Uses sys.argv[1:] by default</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="c1"># Correctly handle single class case for return type matching overloads</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">instances</span> <span class="o">=</span> <span class="n">_instantiate_classes</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">class_arg_configs_maps</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">return</span> <span class="n">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">return</span> <span class="n">instances</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="October 15, 2025 05:37:44 UTC"><span class="timeago" datetime="2025-10-15T05:37:44+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="October 15, 2025 05:37:44 UTC">2025-10-15</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="October 15, 2025 05:37:44 UTC"><span class="timeago" datetime="2025-10-15T05:37:44+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="October 15, 2025 05:37:44 UTC">2025-10-15</span>
  </span>

    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:yuge.zhang@microsoft.com">Yuge Zhang</a>
    </nav>
  </span>

    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
  
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
    
  <script>
    // Show warning banner if not viewing stable documentation
    document.addEventListener("DOMContentLoaded", function() {
      const currentURL = window.location.href;
      const warningDiv = document.getElementById("version-warning");

      // Check if we're on the stable docs or the redirect page
      if (currentURL.includes('agent-lightning/latest/')) {
        // Show warning for explicitly latest docs
        warningDiv.style.display = "block";
      }
    });
  </script>

  </body>
</html>